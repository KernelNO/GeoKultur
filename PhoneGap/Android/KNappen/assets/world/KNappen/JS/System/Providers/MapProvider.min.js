var System;(function(n){(function(n){var t=function(){function n(){this.map=null,this.cacheRead=null,this.cacheWrite=null,this.cacheReadHits=0,this.cacheWrites=0,this.cacheFull=!1,this.layerMarkers=null,this.layerWMS=null}return n.prototype.Init=function(n,t,i){var f,u,r;log.debug("MapProvider","Init"),OpenLayers.IMAGE_RELOAD_ATTEMPTS=3,r=this,n||(f=function(){if(window.scrollTo(0,0),document.body.style.height="100%",!/(iphone|ipod)/.test(navigator.userAgent.toLowerCase())&&document.body.parentNode){var n=document.body.parentNode;n.style.height="100%"}},setTimeout(f,700),setTimeout(f,1500)),u=OpenLayers.Util.getParameters(window.location.href).renderer,u=u?[u]:OpenLayers.Layer.Vector.prototype.renderers,this.map=new OpenLayers.Map({units:"m",numZoomLevels:config.mapMaxZoomLevel,projection:new OpenLayers.Projection("EPSG:900913"),mapExtent:new OpenLayers.Bounds(-25e5,35e5,3045984,9045984),div:t,theme:null,controls:[new OpenLayers.Control.Attribution,new OpenLayers.Control.TouchNavigation({dragPanOptions:{enableKinetic:!0}})]}),this.map.getNumZoomLevels=function(){return config.mapMaxZoomLevel-config.mapMinZoomLevel+1},this.map.isValidZoomLevel=function(n){var t=n!=null&&n>=config.mapMinZoomLevel&&n<=config.mapMaxZoomLevel;return t||r.map.getZoom()!=0||r.map.zoomTo(config.mapMaxZoomLevel-(config.mapMaxZoomLevel-config.mapMinZoomLevel)/2),t},n||(this.changeLayer(i),this.layerMarkers=new OpenLayers.Layer.Markers("Markers"),this.map.addLayer(this.layerMarkers),this.map.setLayerIndex(this.layerMarkers,100),r=this,setTimeout(function(){r.map.updateSize()},300))},n.prototype.changeLayer=function(n){this.mapType=n,this.layerWMS&&(this.map.removeLayer(this.layerWMS),this.layerWMS.destroy()),this.layerWMS=this.createLayer(n),this.map.addLayer(this.layerWMS),this.map.setLayerIndex(this.layerWMS,1e3)},n.prototype.showLayer=function(){this.layerWMS&&(this.map.removeLayer(this.layerWMS),this.map.addLayer(this.layerWMS),this.map.setLayerIndex(this.layerWMS,1e3))},n.prototype.hideLayer=function(){this.layerWMS&&(this.map.removeLayer(this.layerWMS),this.map.addLayer(this.layerWMS),this.map.setLayerIndex(this.layerWMS,1e3))},n.prototype.updateSize=function(){this.layerWMS&&(this.map.removeLayer(this.layerWMS),this.map.addLayer(this.layerWMS),this.map.setLayerIndex(this.layerWMS,1e3)),this.layerMarkers&&this.map.setLayerIndex(this.layerMarkers,100),this.map.updateSize()},n.prototype.createLayer=function(n,t,i){typeof t=="undefined"&&(t=null),typeof i=="undefined"&&(i=1),t||(t=[new OpenLayers.Strategy.Fixed]);var u=n.split(":"),r=u[0],f=u[1],e=u[2];if(r=="OSM")return new OpenLayers.Layer.OSM("OpenStreetMap");if(r=="GoogleStreets")return new OpenLayers.Layer.Google("Google Streets");if(r=="GooglePhysical")return new OpenLayers.Layer.Google("Google Physical",{type:google.maps.MapTypeId.TERRAIN});if(r=="GoogleHybrid")return new OpenLayers.Layer.Google("Google Hybrid",{type:google.maps.MapTypeId.HYBRID});if(r=="GoogleSatellite")return new OpenLayers.Layer.Google("Google Satellite",{type:google.maps.MapTypeId.SATELLITE});if(r=="BingRoad")return new OpenLayers.Layer.Bing({name:"Bing Road",key:config.mapBingAPIKey,type:"Road"});if(r=="BingHybrid")return new OpenLayers.Layer.Bing({name:"Bing Hybrid",key:config.mapBingAPIKey,type:"AerialWithLabels"});if(r=="BingAerial")return new OpenLayers.Layer.Bing({name:"Bing Aerial",key:config.mapBingAPIKey,type:"Aerial"});if(r=="WMS")return new OpenLayers.Layer.WMS("OpenLayers WMS",config.openLayersMapUrl[f],{layers:e,format:"image/jpeg"},{buffer:i,isBaseLayer:!0,transitionEffect:"resize",eventListeners:{tileloaded:this.updateHits}},{strategies:t});if(r=="WMTS")return new OpenLayers.Layer.WMS("OpenLayers WMTS",config.openLayersMapUrl[f],{layers:e,format:"image/jpeg"},{buffer:i,isBaseLayer:!0,transitionEffect:"resize",eventListeners:{tileloaded:this.updateHits}});log.error("MapProvider","Unknown map type: "+r)},n.prototype.updateStatus=function(){},n.prototype.updateHits=function(){},n.prototype.addMarker=function(n,t){log.verboseDebug("MapProvider","PoI: "+n.id()+" at "+n.pos().toString());var r=new OpenLayers.Size(n.iconWidth(),n.iconHeight()),u=new OpenLayers.Pixel(-(r.w/2),-r.h),f=new OpenLayers.Icon(n.iconCategoryURL(),r,u),e=new OpenLayers.LonLat(n.pos().lon(),n.pos().lat()).transform(new OpenLayers.Projection("EPSG:4326"),this.map.getProjectionObject()),i=new OpenLayers.Marker(e,f);return i.events.register("click",i,t),i.events.register("touchstart",i,t),this.layerMarkers.addMarker(i),i},n.prototype.addMapClickEvent=function(){log.debug("MapProvider","addClickEvent")},n.prototype.getPosFromPx=function(n){return this.map.getLonLatFromPixel(n).transform(this.map.getProjectionObject(),new OpenLayers.Projection("EPSG:4326"))},n.prototype.removeMarker=function(n){n.erase(),n.destroy()},n.prototype.clearMarkers=function(){this.layerMarkers.clearMarkers()},n.prototype.setCenter=function(n,t){log.debug("MapProvider","setCenter: Zoomlevel: "+t);var i=new OpenLayers.LonLat(n.lon(),n.lat()).transform(new OpenLayers.Projection("EPSG:4326"),this.map.getProjectionObject());t?this.map.setCenter(i,t):this.map.setCenter(i)},n}();n.MapProvider=t})(n.Providers||(n.Providers={}));var t=n.Providers})(System||(System={}))