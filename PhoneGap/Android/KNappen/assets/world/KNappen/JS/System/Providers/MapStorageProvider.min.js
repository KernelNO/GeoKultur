var System,mapStorageProvider;(function(n){(function(n){var t=function(){function n(){this.enabled=!0}return n.prototype.setEnabled=function(n){log.debug("MapStorageProvider","Setting enabled state to: "+n),this.enabled=n},n.prototype.get=function(n,t){if(!this.enabled)return null;var i=null;return n==="standard"&&(i=storageProvider.get("map:standard:"+stringUtils.hash(t))),i?log.debug("MapStorageProvider","Getting tile from standard cache: "+t):(i=storageProvider.get("map:precache:"+stringUtils.hash(t)),i&&log.debug("MapStorageProvider","Getting tile from precache: "+t)),i||log.debug("MapStorageProvider","Getting tile from cache failed: "+t),i},n.prototype.set=function(n,t,i){if(!this.enabled)return null;log.debug("MapStorageProvider","Adding tile to cache: "+t);var r="map:"+n+":"+stringUtils.hash(t);storageProvider.set(r,i),this.cleanHistory(n)},n.prototype.cleanHistory=function(n){var f="map:"+n+":",t=[],r,u,i;if($.each(storageProvider.getAll(),function(n,i){stringUtils.startsWith(n,f)&&!stringUtils.endsWith(n,".meta")&&t.push({key:n,value:i,meta:storageProvider.getMeta(n)})}),t.sort(function(n,t){return n.meta.changed-t.meta.changed}),r=config.mapCacheTileLimit[n],r<1&&(r=1e4),u=t.length-r,u>0)for(i=0;i<u;i++)log.debug("MapStorageProvider","Removing cache overflow:"+t[i].meta.changed+": "+t[i].key),storageProvider.remove(t[i].key)},n.prototype.clear=function(n){log.info("MapStorageProvider","Clearing cache for type: "+n);var t="map:"+n+":";$.each(storageProvider.getAll(),function(n){stringUtils.startsWith(n,t)&&!stringUtils.endsWith(n,".meta")&&storageProvider.remove(n)})},n}();n.MapStorageProvider=t})(n.Providers||(n.Providers={}));var t=n.Providers})(System||(System={})),mapStorageProvider=new System.Providers.MapStorageProvider