var System;(function(n){(function(n){var t=function(){function n(){this.arState=!0,this.poiDivs=[],this.poiQueue=[],this.poiQueuehtmlDrawCallback=null,this._events=$(this)}return n.prototype.PreInit=function(){var n;log.info("WikitudeProvider","PreInit()"),n=this;try{}catch(t){AR.context.scene.maxScalingDistance=1e3,AR.context.scene.maxScalingDistance=2e4,AR.context.scene.scalingFactor=.5}n=this,setInterval(function(){n.processQueueTick()},config.wikitudeAddPoiDelayMs)},n.prototype.addPoiClickHandler=function(n){this._events.on("PoiClick",n)},n.prototype.resetARState=function(){log.debug("WikitudeProvider","Setting startup AR camera state.");try{this.enableAR(!1)}catch(n){log.error("WikitudeProvider","Error changing AR camera state: "+n)}},n.prototype.enableAR=function(n){try{log.debug("WikitudeProvider","Setting AR camera state to: "+n),this.arState==n?(this.arState=n,AR.context.services.camera=n,AR.context.services.sensors=n):log.debug("WikitudeProvider","AR camera state already: "+n)}catch(t){log.error("WikitudeProvider","Error changing AR camera state: "+t)}},n.prototype.resultToWikitudePoI=function(n,t){var i=0;n&&n()&&(i=n().length),log.debug("WikitudeProvider","Queueing "+i+" PoIs for draw. "+config.wikitudeAddPoiDelayMs+" ms delay between each.");try{AR.context.destroyAll()}catch(r){log.error("WikitudeProvider","Error running AR.context.destroyAll(): "+r)}this.poiQueue=[];try{this.startRadar()}catch(r){log.error("WikitudeProvider","Error running startRadar(): "+r)}this.poiQueuehtmlDrawCallback=t,this.poiQueue=n().slice(0)},n.prototype.processQueueTick=function(){if(this.poiQueue.length>0){var n=this.poiQueue.shift();this.resultToWikitudePoIItem(n,this.poiQueuehtmlDrawCallback)}},n.prototype.resultToWikitudePoIItem=function(n,t){try{this._resultToWikitudePoIItem(n,t)}catch(i){log.error("WikitudeProvider","Error resultToWikitudePoIItem: "+i)}},n.prototype._resultToWikitudePoIItem=function(n,t){var i,u;if(n&&n.pos()&&n.pos().lat()&&n.pos().lon()){i=[],u=t(n)||"<div style='background-color: white; color: black;'>No HTML data for POI<\/div>";try{var s=this._events,h=new AR.GeoLocation(parseFloat(n.pos().lat()),parseFloat(n.pos().lon())),f=new AR.HtmlDrawable({html:u},1,{updateRate:AR.HtmlDrawable.UPDATE_RATE.STATIC,scale:24,offsetX:1,onClick:function(){return log.info("WikitudeProvider","User clicked "+n.id()),s.trigger("PoiClick",[n]),!0},_verticalAnchor:AR.CONST.HORIZONTAL_ANCHOR.MIDDLE,opacity:1,clickThroughEnabled:!0});i.push(f);var e=new AR.Circle(.05,{style:{fillColor:"#3eaebe"}}),c=new AR.GeoObject(h,{drawables:{cam:i,radar:e}}),r=n;r.htmlDrawable=f,r.radarCircle=e,r.geoObject=c}catch(o){stringUtils.startsWith(o.message,"AR")||log.error("WikitudeProvider","Exception adding PoI to AR: "+o)}}},n.prototype.startRadar=function(){log.debug("WikitudeProvider","Setting up radar"),AR.radar.background=new AR.ImageResource("Images/radarImg.png"),AR.radar.positionX=.1,AR.radar.positionY=.1,AR.radar.width=.2,AR.radar.centerX=.5,AR.radar.centerY=.5,AR.radar.radius=.2,AR.radar.northIndicator.image=new AR.ImageResource("Images/north_arrow.png"),AR.radar.northIndicator.radius=.2,AR.radar.onClick=function(){log.info("WikitudeProvider","Radar was clicked")},AR.radar.enabled=!0},n}();n.WikitudeProvider=t})(n.Providers||(n.Providers={}));var t=n.Providers})(System||(System={}))