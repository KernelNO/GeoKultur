var System,viewController;(function(n){(function(t){var r=function(){function n(){}return n}(),i;t.ViewControllerItem=r,i=function(){function t(){this.knownViews={},this.viewHistory=[],this._this=$(this);var n=this;window.onhashchange=function(){n.processUrl()}}return t.prototype.processUrl=function(){var t=location.hash,n;return t.indexOf("#")<0?null:(n=t.replace("#",""),log.debug("ViewController","Hash navigation: "+n),this.openView(n))},t.prototype.AddView=function(t){log.debug("ViewController","Adding view: "+t);var i=new n.GUI.ViewControllerItem;if(i.name=t,i.item=$("#"+t),!i.item){log.error("ViewController","View '"+t+"' not found.");return}this.knownViews[t]=i},t.prototype.getViews=function(){return this.knownViews},t.prototype.goBack=function(){if(log.debug("ViewController","goBack: History length: "+this.viewHistory.length),this.viewHistory.length<1)return!1;var n=this.viewHistory.pop();return n&&n.name?(this.selectView(n.name),log.debug("ViewController","goBack: Last page: "+n.name),!0):(log.debug("ViewController","goBack: No more history items."),!1)},t.prototype.getCurrentView=function(){return this.currentView},t.prototype.getOldView=function(){return this.oldView},t.prototype.selectView=function(n){var t=this.openView(n);for(this.oldView&&this.viewHistory.push(this.oldView);this.viewHistory.length>config.maxViewControllerBackHistory;)this.viewHistory.shift();return t},t.prototype.openView=function(n){var t=this.knownViews[n];return t?(log.debug("ViewController","selectView: View '"+n+"' selected."),this.currentView&&this.currentView.name==n)?this.currentView:(this.oldView=this.currentView,this.doPreSelectEvent(this.oldView,t),this.currentView=t,this.hideAllViews(),t.item.show(),this.doSelectEvent(this.oldView,t),this.doPostSelectEvent(this.oldView,t),this.currentView):(log.error("ViewController","selectView: View '"+n+"' does not exist."),null)},t.prototype.hideAllViews=function(){$.each(this.knownViews,function(n,t){t.item.hide()})},t.prototype.addPreSelectEvent=function(n){this._this.on("PreSelectView",n)},t.prototype.addSelectEvent=function(n){this._this.on("SelectView",n)},t.prototype.addPostSelectEvent=function(n){this._this.on("PostSelectView",n)},t.prototype.doPreSelectEvent=function(n,t){this._this.trigger("PreSelectView",[n,t])},t.prototype.doSelectEvent=function(n,t){this._this.trigger("SelectView",[n,t])},t.prototype.doPostSelectEvent=function(n,t){this._this.trigger("PostSelectView",[n,t])},t}(),t.ViewController=i})(n.GUI||(n.GUI={}));var t=n.GUI})(System||(System={})),viewController=new System.GUI.ViewController