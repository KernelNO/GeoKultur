var System,templateProvider;(function(n){(function(t){var i=function(){function t(){this.templates={}}return t.prototype.queueTemplateDownload=function(t,i,r,u){var e,f,o;typeof i=="undefined"&&(i=null),typeof r=="undefined"&&(r=null),typeof u=="undefined"&&(u=null),log.debug("TemplateProvider","Queued template for download: "+t),e=this,stringUtils.endsWith(config.TemplateProviderFolder,"/")||stringUtils.startsWith(t,"/")||(t="/"+t),f=config.TemplateProviderFolder+t,o=new n.Providers.HttpDownloadItem(t,f,function(n){log.debug("TemplateProvider","Success downloading template "+t),e.setTemplate(t,n),i&&i(n)},function(n){log.error("TemplateProvider","Error downloading template "+t+" ("+f+"): "+n),r&&r(n)},function(){u&&u()},"html"),httpDownloadProvider.enqueueItem("Templates",n.Providers.HttpDownloadQueuePriority.High,o)},t.prototype.setTemplate=function(n,t){log.debug("TemplateProvider","Setting template: "+n),this.templates[n.toUpperCase()]=t},t.prototype.getTemplate=function(n,t){typeof t=="undefined"&&(t=null);var i=this.templates[n.toUpperCase()];return i?(i=translater.translateSubString(i),t&&(i=i.replace(/\$\[([^\]]+)\]/gm,function(n,i){var r=t[i];return typeof r=="function"&&(r=r()),r}),i=i.replace(/\$IF(\(\![\s\S]*?)\$ENDIF/gm,function(n,i){var u=i.replace(/^\(\!([^\)]+)\)[\s\S]*/gm,"$1"),r=t[u];return(typeof r=="function"&&(r=r()),!r)?i.replace(/^\([^\)]+\)([\s\S]*)/gm,"$1"):""}),i=i.replace(/\$IF(\([\s\S]*?)\$ENDIF/gm,function(n,i){var u=i.replace(/^\(([^\)]+)\)[\s\S]*/gm,"$1"),r=t[u];return(typeof r=="function"&&(r=r()),r)?i.replace(/^\([^\)]+\)([\s\S]*)/gm,"$1"):""})),log.debug("TemplateProvider","Returning template: "+n),i):(log.error("TemplateProvider","Template "+n+" does not exist."),"")},t.prototype.getReplacementKeys=function(n){var t={};return $.each(n,function(n,i){t[n]=i}),$.each(config,function(n,i){t["config."+n]=i}),t},t}();t.TemplateProvider=i})(n.Providers||(n.Providers={}));var t=n.Providers})(System||(System={})),templateProvider=new System.Providers.TemplateProvider,startup.addPostInit(function(){})