var System,httpDownloadProvider;(function(n){(function(t){var u=function(){function n(n,t,i,r,u,f){typeof f=="undefined"&&(f="html"),this.id=n,this.url=t,this.doneCallback=i,this.failCallback=r,this.alwaysCallback=u,this.dataType=f}return n}(),f,r,i;t.HttpDownloadItem=u,function(n){n[n.Low=0]="Low",n[n.Normal=1]="Normal",n[n.High=2]="High"}(t.HttpDownloadQueuePriority||(t.HttpDownloadQueuePriority={})),f=t.HttpDownloadQueuePriority,r=function(){function n(){this.httpDownloadQueue=new i,this.currentDownloadCount=0,this.paused=!1;var n=this;setInterval(function(){n.tick()},500)}return n.prototype.enqueueItem=function(n,t,i){this.httpDownloadQueue.enqueue(n,t,i)},n.prototype.clearQueue=function(n){this.httpDownloadQueue.clearQueue(n)},n.prototype.tick=function(){if(!this.paused&&!(this.currentDownloadCount>config.httpDownloadMaxSimultaneousDownloads)){var n=this.httpDownloadQueue.getNext();n&&this.executeDownload(n)}},n.prototype.executeDownload=function(n){var t=this,r;try{t.currentDownloadCount++,r=$.ajax({url:n.url,dataType:n.dataType}).done(function(t){n.doneCallback&&n.doneCallback(t)}).fail(function(t,i,r){n.failCallback&&n.failCallback(i+": "+r)}).always(function(){t.currentDownloadCount--,n.alwaysCallback&&n.alwaysCallback()})}catch(i){log.error("HttpDownloadProvider",'Exception starting download of URL "'+n.url+'": '+i),t.currentDownloadCount--,n.failCallback("Exception: "+i),n.alwaysCallback()}},n}(),t.HttpDownloadProvider=r,i=function(){function t(){this.queues={},this.queues[n.Providers.HttpDownloadQueuePriority.Low.toString()]={},this.queues[n.Providers.HttpDownloadQueuePriority.Normal.toString()]={},this.queues[n.Providers.HttpDownloadQueuePriority.High.toString()]={}}return t.prototype.enqueue=function(n,t,i){log.verboseDebug("HttpDownloadProvider","Enqueue:"+n+":"+t.toString()+": ID: "+(i.id||"<null>")+", URL: "+i.url);var r=this.queues[t.toString()];r[n]||(log.verboseDebug("HttpDownloadProvider","Queue "+n+":"+t.toString()+" created (first time use)."),r[n]=[]),r[n].push(i),log.verboseDebug("HttpDownloadProvider","Queue "+n+":"+t.toString()+" length: "+r[n].length)},t.prototype.clearQueue=function(t){log.verboseDebug("HttpDownloadProvider","ClearQueue:"+t),this._clearQueue(n.Providers.HttpDownloadQueuePriority.Low,t),this._clearQueue(n.Providers.HttpDownloadQueuePriority.Normal,t),this._clearQueue(n.Providers.HttpDownloadQueuePriority.High,t)},t.prototype._clearQueue=function(n,t){var i=this.queues[n.toString()];i[t]&&(i[t]=undefined)},t.prototype.getNext=function(){var t=null;return(t=this._getNext(n.Providers.HttpDownloadQueuePriority.High),t)?t:(t=this._getNext(n.Providers.HttpDownloadQueuePriority.Normal),t)?t:(t=this._getNext(n.Providers.HttpDownloadQueuePriority.Low),t)?t:null},t.prototype._getNext=function(n){var r=this.queues[n.toString()],t=null,i=null;return $.each(r,function(n,r){if(r&&r.length>0&&!t){i=n,t=r.shift();return}}),t&&log.verboseDebug("HttpDownloadProvider","GetNext(returns):"+i+":"+n.toString()+": ID: "+(t.id||"<null>")+", URL: "+t.url),t},t}(),t.HttpDownloadQueue=i})(n.Providers||(n.Providers={}));var t=n.Providers})(System||(System={})),httpDownloadProvider=new System.Providers.HttpDownloadProvider