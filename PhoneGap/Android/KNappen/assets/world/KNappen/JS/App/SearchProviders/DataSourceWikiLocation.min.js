var App;(function(n){(function(t){var i=function(){function t(){}return t.prototype.search=function(t,i,r){if(log.debug("DataSourceWikiLocation","Searching"),!t.pos()||!t.pos().lat()||!t.pos().lon()){log.debug("DataSourceWikiLocation","Have no pos. Search not possible.");return}var u=this.searchCriteriaToDigitalArkivetUrl(t);log.info("DataSourceWikiLocation","Search URL: "+u),$.getJSON(u,function(t){var e,f,r;log.info("DataSourceWikiLocation","Processing result from: "+u),e=t.articles,f=[],$.each(e,function(t,i){var r=new n.Models.PointOfInterest;r.source("wikipedia"),r.sourceType("wikipedia"),r.owner("Wikipedia"),r.id(i.id),r.name(i.title),r.pos(new System.Models.Position(i.lat,i.lng)),r.link(i.mobileurl||""),r.tags(i.type||""),r.ingress("<a href='"+i.mobileurl+"'>"+tr.translate("Wikipedia article")+"<\/a>"),r.body(""),r.license(""),r.institution(""),r.creator(""),r.year(""),r.categories.push("wikipedia"),r.linkMoreInfo(""),r.landingPage(i.mobileurl),f.push(r)}),r=new n.Models.SearchResult,r.numFound(t.total_found),r.items(f),i(r)}).fail(function(n,t,i){r(i)})},t.prototype.searchCriteriaToDigitalArkivetUrl=function(n){return"http://api.wikilocation.org/articles?format=json&lat="+n.pos().lat()+"&lng="+n.pos().lon()+"&limit="+n.rows()+"&locale=no&radius="+n.radius()*1e3+"&offset="+n.rows()*(n.pageNumber()-1)},t}();t.DataSourceWikiLocation=i})(n.SearchProviders||(n.SearchProviders={}));var t=n.SearchProviders})(App||(App={}))