var App;(function(n){(function(t){var i=!1,r=3,u=function(){function t(){}return t.prototype.search=function(t,u,f){var o,e;log.debug("DataSourceNorvegiana","Searching"),o=this,i=!0,e=this.searchCriteriaNorgevianaToUrl(t),log.info("DataSourceNorvegiana","Search URL: "+e),$.getJSON(e,function(t){var s,o,f;log.info("DataSourceNorvegiana","Processing result from: "+e),i=!1,r=config.norvegianaAutoRetryCount,s=t.result.items,o=[],$.each(s,function(t,i){var u=i.item.fields,f="",s,h,c,r,e,l;f=u.abm_geo,f==null&&(f=u.abm_latLong),s=null,f!=null&&(f=f[0].toString().split(","),h=f[0],c=f[1],s=new System.Models.Position(h,c)),r=new n.Models.PointOfInterest,r.source("norvegiana"),r.sourceType("fagdata"),r.id(u.delving_hubId),r.name(u.dc_title),r.description(u.dc_description||""),r.link(u.dc_identifier||""),r.pos(s),e=u.delving_thumbnail,e&&(e=e[0]),r.thumbnail(e||""),r.year(u.dc_date||""),r.landingPage(u.delving_landingPage||""),r.ingress(u.abm_introduction||""),r.license(u.europeana_rights||""),u.abm_category&&$.each(u.abm_category,function(n,t){t=t.replace(new RegExp("(d+)$","gi"),""),r.categories.push(t)}),r.tags(u.dc_subject||""),r.institution(u.europeana_dataProvider||""),r.owner(u.abm_contentProvider||""),r.creator(u.dc_creator||""),r.linkMoreInfo(u.dcterms_references||""),r.originalVersion(u.europeana_isShownAt||""),l=null,$.each(u.europeana_type,function(n,t){r.mediaTypes.push(t)}),r.soundUri(u.abm_soundUri||null),r.videoUri(u.abm_videoUri||null),o.push(r)}),f=new n.Models.SearchResult,f.numFound(t.result.query.numfound),f.items(o),u(f)}).fail(function(n,t,i){f(i)})},t.prototype.searchCriteriaNorgevianaToUrl=function(t){var r="",f,u,i;return t.norvegiana_qf()&&t.norvegiana_qf().length>0&&($.each(t.norvegiana_qf(),function(n,t){r!=""&&(r+=","),r+="europeana_dataProvider_facet:"+t}),r="&qf%5B%5D="+r),f="",t.radius()!=null&&t.radius()!=0&&t.pos()!=null&&t.pos().lat()!=null&&t.pos().lon()!=null&&(f="&pt="+t.pos().lat()+","+t.pos().lon()+"&d="+t.radius()),u=t.query(),u&&u!=""||(u="*:*"),u=u.replace("%","*"),i="",t.sort&&t.sort!=n.Models.SearchCriteriaSortingEnum.Distance||(i=null),t.sort==n.Models.SearchCriteriaSortingEnum.PublishingDate&&(i=""),t.sort==n.Models.SearchCriteriaSortingEnum.Subject&&(i=""),i&&i!=""&&(i="&sortby="+i),i||(i=""),t.category()&&t.category()!="*"&&(r+="&qf=abm_category_text:"+t.category()),t.mediaType()&&t.mediaType()!="*"&&(r+="&qf=europeana_type_facet:"+t.mediaType()),config.norvegianaURL+encodeURIComponent(u)+f+"&rows="+t.rows()+"&start="+(t.rows()*(t.pageNumber()-1)+1)+"&format=json"+i+r},t}();t.DataSourceNorvegiana=u})(n.SearchProviders||(n.SearchProviders={}));var t=n.SearchProviders})(App||(App={}))