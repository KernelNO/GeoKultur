var App,poiController;(function(n){(function(n){var t=function(){function n(){}return n.prototype.PreInit=function(){log.debug("PoiController","PreInit()"),templateProvider.queueTemplateDownload(config.templatePOIPreview),templateProvider.queueTemplateDownload(config.templatePOIDetailsView)},n.prototype.Init=function(){log.debug("PoiController","Init()"),$("body").append('<div id="poiPreview"><\/div>'),$(document).mousedown(function(){var n=viewController.getCurrentView();n&&n.name!="poiView"&&n.name!="arView"&&poiController.hidePoiPreview()}),viewController.addPostSelectEvent(function(n,t){t&&t.name=="poiView"&&poiController.closeDetail()}),viewController.addSelectEvent(function(n,t,i){i.name==="poiView"?windowSizeController.HideTopMenu():t&&t.name=="poiView"&&(windowSizeController.ShowTopMenu(),poiController.hidePoiPreview())})},n.prototype.OpenPreview=function(n,t){var i=this,r=$("#poiPreview"),u=templateProvider.getReplacementKeys(n),f=templateProvider.getTemplate(config.templatePOIPreview,u);r.html(f),phoneGapProvider.fixALinksIfPhoneGap(r),i=this,$("#closePreviewBtn").mousedown(function(){i.hidePoiPreview()}),$("#openDetailBtn").mousedown(function(){i.OpenDetail(n)}),t&&$("#poiPreview").show()},n.prototype.renderMediaIcons=function(n){var t,i,r=pointOfInterestTypeProvider.getMediaType(n);return $.each(r,function(n,r){i='<img src="'+r.icon+'" class="mediaImage"/>',t.push(i)}),t.toString()},n.prototype.OpenDetail=function(n){var t,u,f,i,r;log.debug("PoiController","OpenDetail"),$("#poiPreview").addClass("poiPreviewActiveDetail").show(),$("#poiPreview #openDetailBtn").hide(),t=this,u=templateProvider.getReplacementKeys(n),viewController.selectView("poiView"),f=templateProvider.getTemplate(config.templatePOIDetailsView,u),i=$("#poiView"),i.html(f),phoneGapProvider.fixALinksIfPhoneGap(i),$.each(n.mediaTypes(),function(i,r){r=r.toUpperCase(),r=="IMAGE"&&t.showImage(n.thumbnail()),r=="VIDEO"&&n.videoUri()&&t.showVideo(n.videoUri()[0]),r=="SOUND"&&n.soundUri()&&t.showAudio(n.name()[0],n.soundUri()[0])}),r=$("#detailAccordion"),r.accordion({active:!1,collapsible:!1}),r.accordion("option","icons",{header:"showMoreAccordion",activeHeader:"showLessAccordion"}),$("#detailAccordion .ui-accordion-content").show(),$("#addPoiToRoute").mousedown(function(){routeController.openRouteList(n)}),$("#createNewRouteBtn").mousedown(function(){var t=$("#newRouteName").val();routeController.createRoute(t,n),$("#newRouteName").val("")}),$("#closePreviewBtn").mousedown(function(){viewController.selectView(viewController.getOldView().name)})},n.prototype.closeDetail=function(){$("#poiPreview").removeClass("poiPreviewActiveDetail"),$("#poiPreview #openDetailBtn").show(),this.clearDetail(),this.resetDetail(),_V_("videoElement").src("")},n.prototype.clearDetail=function(){var n=$("#poiDetail");n.find("#poiThumbnail").attr("src","-"),n.find("#poiDetailLicense").html(""),n.find("#poiDetailTags").html(""),n.find("#poiIngress").html(""),n.find("#poiDescription").html(""),n.find("#poiAboutData").html(""),n.find("#poiRelatedLinks").html("")},n.prototype.showVideo=function(n){var t,i;log.debug("PoiController","Setting video URL: "+n),t=_V_("videoElement",{controls:!0,autoplay:!1,preload:"none",customControlsOnMobile:!0},function(){}),t.src(n),i=$("#poiVideo"),i.show()},n.prototype.showAudio=function(n,t){this.showAudioStartButton(n,t)},n.prototype.showAudioStartButton=function(n,t){var r,i,u;log.debug("PoiController","Setting audio URL: "+t),r=this,i=$("#poiAudio"),i.html(""),u=$("<h1><span class='typcn typcn-media-play'><\/span><\/h1>").mousedown(function(){audioController.play(n,t),r.showAudioStopButton(n,t)}),i.append(u),i.show()},n.prototype.showAudioStopButton=function(n,t){var u=this,i=$("#poiAudio"),r;i.html(""),r=$("<h1><span class='typcn typcn-media-stop'><\/span><\/h1>").mousedown(function(){audioController.stop(),u.showAudioStartButton(n,t)}),i.append(r),i.show()},n.prototype.showImage=function(n){$("#poiThumbnail").attr("src",n).show(),$("#poiImage").show()},n.prototype.resetDetail=function(){$("#poiVideo").hide(),$("#poiAudio").hide(),$("#poiImage").hide(),$("#addPoiToRouteForm").hide();var n=this;n.hidePoiPreview(),$("#closePreviewBtn").mousedown(function(){n.hidePoiPreview()})},n.prototype.hidePoiPreview=function(){$("#poiPreview").hide()},n.prototype.hidePoiDialogues=function(){this.hidePoiPreview()},n}();n.PoiController=t})(n.Controllers||(n.Controllers={}));var t=n.Controllers})(App||(App={})),poiController=new App.Controllers.PoiController,startup.addPreInit(function(){poiController.PreInit()},"PoiController"),startup.addInit(function(){poiController.Init()},"PoiController")