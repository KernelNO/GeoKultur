var App,searchController;(function(n){(function(t){var i=function(){function t(){this.searchCriteria=new n.Models.SearchCriteria,this.latestSearchResult=null,this.searchProvider=null,this.searched=!1,this._event=$(this)}return t.prototype.addSearchResultCallback=function(n){this._event.on("SearchResult",n)},t.prototype.Init=function(){log.debug("SearchController","Init()");var n=this,t=this.searchCriteria;gpsProvider.addPositionChangedHandler(function(i,r){!n.searched&&mapController.mapProvider.map&&(log.debug("SearchController","Doing first search by userpos"),searchController.searched=!0,t.pos(r),searchController.doSearch(),mapController.mapProvider.setCenter(r,settings.startMapZoomLevel()))}),this.searchCriteria.radius(settings.startSearchDistance()),this.searchCriteria.rows(settings.startResultAmount()),this.searchCriteria.category(settings.startSearchCategory())},t.prototype.doSearch=function(){this.searchProvider&&this.searchProvider.haltSearch(),this.searchProvider=new n.Providers.SearchProvider;var t=this.searchResultCallback,i=this;this.searchProvider.search(this.searchCriteria,function(n){t(i,n)},function(n){log.debug("SearchController",n)})},t.prototype.searchResultCallback=function(n,t){log.debug("SearchController","Triggering callback events"),n.latestSearchResult=t,n._event.trigger("SearchResult",t)},t}();t.SearchController=i})(n.Controllers||(n.Controllers={}));var t=n.Controllers})(App||(App={})),searchController=new App.Controllers.SearchController,startup.addPreInit(function(){searchController.Init()},"SearchController")